<!DOCTYPE html>
<html lang="en-US"> <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Hello World | Model Based Testing</title> <meta name="generator" content="Jekyll v4.2.2"> <meta property="og:title" content="Hello World"> <meta property="og:locale" content="en_US"> <meta name="description" content="A minimal TLA+ spec"> <meta property="og:description" content="A minimal TLA+ spec"> <link rel="canonical" href="https://mbt.informal.systems/docs/tla_basics_tutorials/hello_world.html"> <meta property="og:url" content="https://mbt.informal.systems/docs/tla_basics_tutorials/hello_world.html"> <meta property="og:site_name" content="Model Based Testing"> <meta property="og:type" content="website"> <meta name="twitter:card" content="summary"> <meta property="twitter:title" content="Hello World"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A minimal TLA+ spec","headline":"Hello World","url":"https://mbt.informal.systems/docs/tla_basics_tutorials/hello_world.html"}</script> <!-- End Jekyll SEO tag --> <script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://mbt.informal.systems/" class="site-title lh-tight"> <div id="minititle">MBT</div> <svg class="site-logo" id="mbtlogo" width="48" height="48" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"> <path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M42.061 29.9924L32.061 10.9924L23.061 29.9924H42.061Z" fill="black"></path> <path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M32.5653 12.073L32.4193 12L24.0653 29.637C24.0103 29.752 23.9903 29.878 24.0043 30H27.8913L34.5513 15.847L32.5653 12.073Z" fill="black"></path> <path opacity="0.3" fill-rule="evenodd" clip-rule="evenodd" d="M32.986 29.9924L23.986 10.9924C23.986 10.9924 17.268 25.1754 15.44 29.0334C15.342 29.2414 15.356 29.4854 15.48 29.6804C15.603 29.8744 15.817 29.9924 16.047 29.9924C19.908 29.9924 32.986 29.9924 32.986 29.9924Z" fill="black"></path> <path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M23.795 11.4139L15.44 29.0509C15.342 29.2589 15.356 29.5029 15.48 29.6979C15.603 29.8919 15.817 30.0099 16.047 30.0099H18.986L25.963 15.1839L24.296 11.6649L23.795 11.4139Z" fill="black"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M27.2589 37C25.7279 37 24.0279 37 22.2589 37C21.7069 37 21.2589 37.448 21.2589 38C21.2589 38.552 21.7069 39 22.2589 39C24.0279 39 25.7279 39 27.2589 39C27.8109 39 28.2589 38.552 28.2589 38C28.2589 37.448 27.8109 37 27.2589 37ZM17.2589 37C15.5429 37 13.8479 37 12.2589 37C11.7069 37 11.2589 37.448 11.2589 38C11.2589 38.552 11.7069 39 12.2589 39C13.8479 39 15.5429 39 17.2589 39C17.8109 39 18.2589 38.552 18.2589 38C18.2589 37.448 17.8109 37 17.2589 37ZM7.25895 37H5.59995C5.39195 37 5.19894 36.892 5.08994 36.715C4.97994 36.538 4.96995 36.317 5.06295 36.131L5.10195 36.055C5.34895 35.562 5.14894 34.961 4.65494 34.713C4.16194 34.466 3.55995 34.666 3.31295 35.16L3.27494 35.236C2.87194 36.042 2.91395 36.999 3.38795 37.766C3.86195 38.533 4.69895 39 5.59995 39C6.09595 39 6.65295 39 7.25895 39C7.81095 39 8.25895 38.552 8.25895 38C8.25895 37.448 7.81095 37 7.25895 37ZM30.8049 33.822L31.9589 36.132C32.0519 36.318 32.0419 36.539 31.9329 36.716C31.8789 36.801 31.8069 36.871 31.7219 36.92C31.2439 37.195 31.0789 37.807 31.3549 38.286C31.6309 38.764 32.2429 38.928 32.7209 38.653C33.0879 38.441 33.4029 38.14 33.6339 37.767C34.1069 37.001 34.1509 36.044 33.7479 35.238L32.5949 32.928C32.3479 32.434 31.747 32.234 31.253 32.48C30.76 32.727 30.5589 33.328 30.8049 33.822ZM7.33994 31.584C8.03594 30.195 8.79595 28.677 9.57795 27.113C9.82595 26.62 9.62595 26.019 9.13195 25.772C8.63795 25.524 8.03694 25.724 7.78994 26.218C7.00694 27.782 6.24695 29.299 5.55195 30.689C5.30495 31.182 5.50495 31.784 5.99795 32.031C6.49195 32.278 7.09294 32.078 7.33994 31.584ZM30.0099 13.764L28.3439 10.433C27.9049 9.555 27.0069 9 26.0259 9C26.0149 9 26.0039 9 25.9929 9C25.0119 9 24.1139 9.555 23.6749 10.433C22.3909 13.001 18.5879 20.608 16.1829 25.417C15.9359 25.91 16.137 26.511 16.63 26.758C17.124 27.005 17.7249 26.805 17.9719 26.311L22.5169 17.222L24.1039 20.402C24.3509 20.895 24.9519 21.096 25.4459 20.85C25.9399 20.603 26.1399 20.002 25.8939 19.508C25.0949 17.909 24.3349 16.386 23.6599 15.035C23.6519 15.018 23.6429 15.002 23.6339 14.987L25.4639 11.327C25.5639 11.127 25.7689 11 25.9929 11H26.0259C26.2499 11 26.4549 11.127 26.5549 11.327L28.8919 16L23.2729 27.237C22.9959 27.79 22.9299 28.415 23.0689 29H18.9999C18.4479 29 17.9999 29.448 17.9999 30C17.9999 30.552 18.4479 31 18.9999 31H40.9999C41.5519 31 41.9999 30.552 41.9999 30C41.9999 29.448 41.5519 29 40.9999 29H36.951C37.089 28.415 37.0229 27.79 36.7459 27.237L31.128 16L33.4629 11.329C33.5639 11.127 33.7699 11 33.9959 11H34.0229C34.2489 11 34.4549 11.127 34.5559 11.329L42.1029 26.423C42.3499 26.917 42.951 27.117 43.445 26.871C43.939 26.624 44.1389 26.023 43.8919 25.529C41.4919 20.728 37.6399 13.025 36.3449 10.435C35.9049 9.555 35.0069 9 34.0229 9C34.0139 9 34.0049 9 33.9959 9C33.0129 9 32.1139 9.555 31.6739 10.435L30.0099 13.764ZM44.006 28C44.555 28.003 44.9999 28.45 44.9999 29C44.9999 29.55 44.555 29.997 44.006 30H43.9999C43.4479 30 42.9999 29.552 42.9999 29C42.9999 28.448 43.4479 28 43.9999 28H44.006ZM15.9999 28C16.5519 28 16.9999 28.448 16.9999 29C16.9999 29.552 16.5519 30 15.9999 30C15.4479 30 14.9999 29.552 14.9999 29C14.9999 28.448 15.4479 28 15.9999 28ZM30.0099 18.236L27.5639 23.128C28.3969 24.794 29.7029 27.406 30.4999 29H34.4209C34.629 29 34.8219 28.892 34.9309 28.715C35.0399 28.539 35.0499 28.318 34.9569 28.132L30.0099 18.236ZM26.514 25.227L25.0619 28.132C24.9689 28.318 24.9789 28.539 25.0879 28.715C25.1969 28.892 25.391 29 25.598 29H28.3979L26.514 25.227ZM11.8169 22.642C12.5909 21.097 13.3499 19.581 14.0549 18.172C14.3019 17.678 14.1019 17.077 13.6089 16.83C13.1149 16.583 12.5139 16.783 12.2669 17.276C11.5619 18.685 10.803 20.201 10.029 21.747C9.78095 22.241 9.98195 22.842 10.475 23.089C10.969 23.336 11.5699 23.136 11.8169 22.642ZM15.4629 10.892L14.505 12.805C14.258 13.299 14.4579 13.9 14.9519 14.147C15.4449 14.394 16.047 14.194 16.294 13.701L17.2519 11.788C17.4929 11.305 17.9869 11 18.5269 11H18.5279C18.9939 11 19.4259 11.228 19.6909 11.601C20.0099 12.051 20.635 12.157 21.085 11.838C21.535 11.519 21.642 10.894 21.322 10.444C20.687 9.547 19.6489 9 18.5279 9H18.5269C17.2299 9 16.0439 9.732 15.4629 10.892Z" fill="black"></path> </svg> </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list">
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://mbt.informal.systems/" class="nav-list-link">Model Based Testing</a><ul class="nav-list "><li class="nav-list-item "><a href="https://mbt.informal.systems/docs/modelator.html" class="nav-list-link">Modelator</a></li></ul>
</li>
<li class="nav-list-item active">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/" class="nav-list-link">TLA+ Basics Tutorials</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/tla+cheatsheet.html" class="nav-list-link">TLA+ cheat sheet</a></li>
<li class="nav-list-item "><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/tutorial.html" class="nav-list-link">Overview</a></li>
<li class="nav-list-item active"><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/hello_world.html" class="nav-list-link active">Hello World</a></li>
<li class="nav-list-item "><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/typechecking.html" class="nav-list-link">Typechecking</a></li>
<li class="nav-list-item "><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/apalache_vs_tlc.html" class="nav-list-link">Apalache vs TLC</a></li>
<li class="nav-list-item "><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/ethereum.html" class="nav-list-link">Ethereum Exploit</a></li>
<li class="nav-list-item "><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/generating_traces.html" class="nav-list-link">Generating Traces</a></li>
<li class="nav-list-item "><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/ecosystem.html" class="nav-list-link">(Bonus) Ecosystem</a></li>
</ul>
</li>
</ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Model Based Testing" aria-label="Search Model Based Testing" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://mbt.informal.systems/docs/tla_basics_tutorials/">TLA+ Basics Tutorials</a></li> <li class="breadcrumb-nav-list-item"><span>Hello World</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="hello-world-using-tlc"> <a href="#hello-world-using-tlc" class="anchor-heading" aria-labelledby="hello-world-using-tlc"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ‘Hello world’ using TLC </h1> <p><strong>The .tla and other referenced files are included <a href="https://github.com/informalsystems/modelator/tree/main/jekyll/docs/tla_basics_tutorials/models">here</a>.</strong></p> <p>Let’s model a system with two processes Alice and Bob. They are connected by a network that can lose and reorder messages. Alice will send two messages “hello” and “world” to Bob in an undetermined order. If Bob receives “hello” and then “world” he will become happy.</p> <p>hello_world.tla contains the model and hello_world.cfg contains the configuration file needed to model check it using TLC.</p> <p>Let’s unpack the body of the .tla file.</p> <h2 id="boilerplate"> <a href="#boilerplate" class="anchor-heading" aria-labelledby="boilerplate"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Boilerplate </h2> <p>You should write TLA in between two lines as below. This is an artifact of the module system.</p>
<pre><code class="language-tla">---- MODULE hello_world ----
\* content here...
====
</code></pre>
<p>We extend (import) a modules from the standard library</p>
<pre><code class="language-tla">EXTENDS Sequences \* Import Sequences module from the standard library
</code></pre>
<p>it provides the Sequence data structure. It is a list.</p> <h2 id="the-state-machine"> <a href="#the-state-machine" class="anchor-heading" aria-labelledby="the-state-machine"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The state machine </h2> <p>In TLA+ you define a state machine. There is an initial state, which is a choice of values for each variable declared. You also define the transitions allowed in the system.</p> <p>We model 4 pieces of state: Alice’s outbox, the messages in the network, Bob’s mood and Bob’s inbox.</p>
<pre><code class="language-tla">VARIABLES
    alices_outbox,
    network,
    bobs_mood,
    bobs_inbox
</code></pre>
<p>The Init <em>operator</em> defines the initial values of the state variables of the model. In TLA+ the term operator is used to mean something like a programming language function. Please take the Init operator on faith right now.</p>
<pre><code class="language-tla">Init ==
    /\ alices_outbox = {} \* Alice has sent nothing (empty set)
    /\ network = {} \* AND so is the network
    /\ bobs_mood = "neutral" \* AND Bob's mood is neutral
    /\ bobs_inbox = &lt;&lt;&gt;&gt; \* AND Bob's inbox is an empty Sequence (list)
</code></pre>
<p>State machine transitions are pairs: (CurrentState, NextState). In TLA+ you describe the transitions allowed in the system by writing a boolean function over pairs (CurrentState, NextState). If a pair makes your boolean function evaluate true then the model checker will check that transition. In fact, the model checker will check <strong>all</strong> transitions that match your boolean function. This is what allows the model checker to exhaustively explore system behavior.</p> <p><em>Practically</em> this means that you define transitions by writing <em>actions</em>: operators that take into account the CurrentState and the NextState. Because the variable names are the same in both states, you denote the NextState variables by appending the <strong>‘</strong> character to identifiers. In TLA+ you write actions OR’ed together in the Next operator.</p>
<pre><code class="language-tla">Next ==
    \/ AliceSend("hello")
    \/ AliceSend("world")
    \/ NetworkLoss
    \/ NetworkDeliver
    \/ BobCheckInbox
</code></pre>
<pre><code class="language-tla">AliceSend(m) == 
    /\ m \notin alices_outbox
    /\ alices_outbox' = alices_outbox \union {m}
    /\ network' = network \union {m}
    /\ UNCHANGED &lt;&lt;bobs_mood, bobs_inbox&gt;&gt;

NetworkLoss == 
    /\ \E e \in network: network' = network \ {e}
    /\ UNCHANGED &lt;&lt;bobs_mood, bobs_inbox, alices_outbox&gt;&gt;

NetworkDeliver == 
    /\ \E e \in network:
        /\ bobs_inbox' = bobs_inbox \o &lt;&lt;e&gt;&gt; 
        /\ network' = network \ {e}
    /\ UNCHANGED &lt;&lt;bobs_mood, alices_outbox&gt;&gt;

BobCheckInbox == 
    /\ bobs_mood' = IF bobs_inbox = &lt;&lt;"hello", "world"&gt;&gt; THEN "happy" ELSE "neutral"
    /\ UNCHANGED &lt;&lt;network, bobs_inbox, alices_outbox&gt;&gt;
</code></pre>
<p>Pretend we are the model checker and we are currently ‘looking’ at the CurrentState <em>C</em>. We compute all possible NextState’s <em>N</em>, but we only consider a candidate <em>N</em> to be valid if Next is true when evaluated over the pair (<em>C</em>, <em>N</em>). Since Next is the OR’ing of actions, the pair will make Next true if it makes at least one of the actions true.</p> <p>Inspect the AliceSend(m) action for example.</p>
<pre><code class="language-tla">AliceSend(m) == 
    /\ m \notin alices_outbox
    /\ alices_outbox' = alices_outbox \union {m}
    /\ network' = network \union {m}
    /\ UNCHANGED &lt;&lt;bobs_mood, bobs_inbox&gt;&gt;
</code></pre>
<p>In English the action says this</p> <p>“I am true when: <br> my argument <em>m</em> is not in the set <em>alices_outbox</em> in the CurrentState <br> AND <em>alices_outbox</em> in the NextState is the same as it is in the CurrentState, but with <em>m</em> included<br> AND <em>network</em> in the NextState is the same as it is in the CurrentState, but with <em>m</em> included<br> AND <em>bobs_mood</em> doesn’t change between the CurrentState and NextState<br> AND <em>bobs_inbox</em> doesn’t change between the CurrentState and NextState “</p> <p>We must include the UNCHANGED keyword - there is no ambiguity in TLA+!</p> <p>Consider NetworkLoss</p>
<pre><code class="language-tla">NetworkLoss == 
    /\ \E e \in network: network' = network \ {e}
    /\ UNCHANGED &lt;&lt;bobs_mood, bobs_inbox, alices_outbox&gt;&gt;
</code></pre>
<p>This action is more advanced: it contains the ‘\E’ (there exists) syntax. It says</p> <p>“I am true when:<br> There is an element e in the <em>network</em> of the CurrentState, and that element is not in the <em>network</em> of NextState<br> AND <em>bobs_mood</em> doesn’t change between the CurrentState and NextState<br> AND … “</p> <p>Let’s consider how a model checker could select a transition, given a current state where</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alices_outbox = {"hello"}
network = {"hello"}
\* ignore bobs variables for now
</code></pre></div></div> <p>knowing that Next is</p>
<pre><code class="language-tla">Next ==
    \/ AliceSend("hello")
    \/ AliceSend("world")
    \/ NetworkLoss
    \* (ignore other operators for now)
</code></pre>
<p>In a pair (CurrentState, NextState) where AliceSend(“world”) was true NextState must look like</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alices_outbox = {"hello", "world"}
network = {"hello", "world"}
\* ignore bobs variables for now
</code></pre></div></div> <p>and in one where NetworkLoss was true NextState would look like</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alices_outbox = {"hello"}
network = {}
\* ignore bobs variables for now
</code></pre></div></div> <p>Next evaluates to true for both of these pairs, and the model checker will check <em>both</em> possibilities for us.</p> <p>Understanding Next as a boolean function over pairs of states is key. The Init operator is a special case, it’s a boolean function over one state only. (It’s not a special case if you consider it to be a boolean function over a pair (IgnoredState, InitialState) for a hidden IgnoredState).</p> <p>We have looked at AliceSend and NetworkLoss. Let’s look at NetworkDeliver and BobCheckInbox.</p>
<pre><code class="language-tla">NetworkDeliver == 
    /\ \E e \in network:
        /\ bobs_inbox' = bobs_inbox \o &lt;&lt;e&gt;&gt; 
        /\ network' = network \ {e}
    /\ UNCHANGED &lt;&lt;bobs_mood, alices_outbox&gt;&gt;
</code></pre>
<p>NetworkDeliver matches transitions where an element e is removed from the network set and added (with the \o operator) to bobs_inbox list.</p>
<pre><code class="language-tla">BobCheckInbox == 
    /\ bobs_mood' = IF bobs_inbox = &lt;&lt;"hello", "world"&gt;&gt; THEN "happy" ELSE "neutral"
    /\ UNCHANGED &lt;&lt;network, bobs_inbox, alices_outbox&gt;&gt;
</code></pre>
<p>As a challenge try to write BobCheckInbox (above) using only the logical operators /\ and \/.</p> <p>Answer:</p>
<pre><code class="language-tla">BobCheckInbox == 
    /\ \/ /\ bobs_mood' = "happy"
          /\ bobs_inbox = &lt;&lt;"hello", "world"&gt;&gt;
       \/ /\ bobs_mood' = "neutral"
          /\ bobs_inbox /= &lt;&lt;"hello", "world"&gt;&gt;
    /\ UNCHANGED &lt;&lt;network, bobs_inbox, alices_outbox&gt;&gt; 
</code></pre>
<h2 id="checking-invariants"> <a href="#checking-invariants" class="anchor-heading" aria-labelledby="checking-invariants"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Checking Invariants </h2> <p>We modeled the state machine so now we can check what properties it has.</p> <p>We can use a model checker to get sample execution traces beginning from the initial state and leading up to some state satisfying some boolean function. Precisely: we can find an sequence of states (T) starting in the initial state and ending in a state S that makes a boolean function P evaluate to true.</p> <p>In common terminology the sequence of states T is called a counterexample, and the boolean function is the negation of an Invariant. This means if we want to find an execution T whose final state satisfies P we write an invariant: Inv == ~P and we check that. (We check that Inv always holds: if it doesn’t then there exists a state where ~Inv = ~~P = P holds).</p> <p>If we want to make sure that no execution exists whose final state satisfies P we write an invariant: Inv == P and we hope that the model checker exhausts its search without finding a trace.</p> <p>Suppose we want to ensure that every (\A means ‘for all’ in TLA+) message in the network was at some point sent by Alice.</p>
<pre><code class="language-tla">NothingUnexpectedInNetwork == \A e \in network: e \in alices_outbox
</code></pre>
<p>NothingUnexpectedInNetwork is a boolean function over a single state. Using the model checker we can check it as an invariant.</p> <p>We use the following configuration for TLC (hello_world.cfg)</p>
<pre><code class="language-tla">INIT Init
NEXT Next

INVARIANTS
NothingUnexpectedInNetwork
</code></pre>
<p>We can check this using the VSCode plugin for TLA (through the context menu), or with</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-cp</span> tla2tools.jar tlc2.TLC <span class="nt">-config</span> hello_world.cfg <span class="nt">-workers</span> auto <span class="nt">-cleanup</span> hello_world.tla

<span class="c"># TLC output:</span>
<span class="c"># ...</span>
<span class="c"># Model checking completed. No error has been found.</span>
</code></pre></div></div> <p>TLC should report no error found: this means that NothingUnexpectedInNetwork was also true in every execution.</p> <p>We may be interested to find an execution where Bob becomes happy. We write the invariant</p>
<pre><code class="language-tla">NotBobIsHappy == 
    LET BobIsHappy == bobs_mood = "happy"
    IN ~BobIsHappy
</code></pre>
<p>which makes use of the <em>LET</em> keyword, used to define values or operators inline.</p> <p>We use the .cfg file</p>
<pre><code class="language-tla">INIT Init
NEXT Next

INVARIANTS
NotBobIsHappy
</code></pre>
<p>We ask TLC to check if ‘always NotBobIsHappy’. If Bob ever becomes happy then it will be false, so TLC will give us a counterexample, or trace, where Bob becomes happy.</p> <p>TLC should spit out a trace</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: Invariant NotBobIsHappy is violated.
Error: The behavior up to this point is:
State 1: &lt;..&gt;
/\ network = {}
/\ alices_outbox = {}
/\ bobs_inbox = &lt;&lt;&gt;&gt;
/\ bobs_mood = "neutral"

State 2: &lt;..&gt;
/\ network = {"hello"}
/\ alices_outbox = {"hello"}
/\ bobs_inbox = &lt;&lt;&gt;&gt;
/\ bobs_mood = "neutral"

State 3: &lt;..&gt;
/\ network = {"hello", "world"}
/\ alices_outbox = {"hello", "world"}
/\ bobs_inbox = &lt;&lt;&gt;&gt;
/\ bobs_mood = "neutral"

State 4: &lt;..&gt;
/\ network = {"world"}
/\ alices_outbox = {"hello", "world"}
/\ bobs_inbox = &lt;&lt;"hello"&gt;&gt;
/\ bobs_mood = "neutral"

State 5: &lt;..&gt;
/\ network = {}
/\ alices_outbox = {"hello", "world"}
/\ bobs_inbox = &lt;&lt;"hello", "world"&gt;&gt;
/\ bobs_mood = "neutral"

State 6: &lt;..&gt;
/\ network = {}
/\ alices_outbox = {"hello", "world"}
/\ bobs_inbox = &lt;&lt;"hello", "world"&gt;&gt;
/\ bobs_mood = "happy"
</code></pre></div></div> <p>Notice that bob is happy in state 6.</p> <h2 id="wrapping-up"> <a href="#wrapping-up" class="anchor-heading" aria-labelledby="wrapping-up"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Wrapping up </h2> <h3 id="this-tutorial"> <a href="#this-tutorial" class="anchor-heading" aria-labelledby="this-tutorial"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> This tutorial </h3> <ol> <li>How to read and write simple TLA+</li> <li>How to structure models with the (boilerplate, variables, Init, Next, .cfg) pattern</li> <li>How to think about transitions in terms of (CurrentState, NextState) pairs</li> <li>How to use <em>actions</em> to specify transitions in the Next operator</li> <li>How to generate traces matching behaviors using TLC</li> </ol> <p>That’s it, congratulations :) Try the next tutorial.</p> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/informalsystems/modelator/tree/main/jekyll/docs/tla_basics_tutorials/hello_world.md" id="edit-this-page">Edit this page on GitHub</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
